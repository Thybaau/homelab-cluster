âœ… Valhafin a Ã©tÃ© dÃ©ployÃ© avec succÃ¨s dans le namespace {{ .Values.global.namespace }} !

ğŸ“‹ VÃ‰RIFICATION DU DÃ‰PLOIEMENT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. VÃ©rifier l'Ã©tat des pods :
   kubectl get pods -n {{ .Values.global.namespace }}

   Attendez que tous les pods soient en Ã©tat "Running" et "Ready".

2. VÃ©rifier les services :
   kubectl get svc -n {{ .Values.global.namespace }}

3. VÃ©rifier les secrets :
   kubectl get sealedsecrets,secrets -n {{ .Values.global.namespace }}

   Note : Les SealedSecrets doivent Ãªtre automatiquement dÃ©chiffrÃ©s en Secrets
   par le Sealed Secrets Controller.

ğŸŒ ACCÃˆS Ã€ L'APPLICATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
{{- if .Values.ingress.enabled }}
{{- range .Values.ingress.hosts }}

L'application est accessible via : http://{{ .host }}

âš ï¸  Si vous utilisez un hostname local ({{ .host }}), ajoutez-le Ã  votre fichier /etc/hosts :

   # Pour un cluster local (minikube, kind, k3s)
   <IP_DU_CLUSTER> {{ .host }}

   Exemples :
   - Minikube : $(minikube ip) {{ .host }}
   - Kind : 127.0.0.1 {{ .host }}
   - K3s : <IP_DU_NODE> {{ .host }}
{{- end }}
{{- else }}

âš ï¸  L'Ingress est dÃ©sactivÃ©. Pour accÃ©der Ã  l'application, utilisez port-forward :

   # Frontend
   kubectl port-forward -n {{ .Values.global.namespace }} svc/{{ include "valhafin.fullname" . }}-frontend 8080:80

   # Backend
   kubectl port-forward -n {{ .Values.global.namespace }} svc/{{ include "valhafin.fullname" . }}-backend 8081:8080

   AccÃ©dez ensuite Ã  http://localhost:8080 pour le frontend.
{{- end }}

ğŸ” SURVEILLANCE ET LOGS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Consulter les logs du backend :
   kubectl logs -n {{ .Values.global.namespace }} -l app.kubernetes.io/component=backend --tail=100 -f

Consulter les logs du frontend :
   kubectl logs -n {{ .Values.global.namespace }} -l app.kubernetes.io/component=frontend --tail=100 -f

Consulter les logs de la base de donnÃ©es :
   kubectl logs -n {{ .Values.global.namespace }} -l app.kubernetes.io/component=database --tail=100 -f

VÃ©rifier les Ã©vÃ©nements du namespace :
   kubectl get events -n {{ .Values.global.namespace }} --sort-by='.lastTimestamp'

ğŸ” GESTION DES SECRETS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
{{- if .Values.sealedSecrets.enabled }}

Les secrets sont gÃ©rÃ©s via Sealed Secrets. Pour mettre Ã  jour un secret :

1. CrÃ©ez un Secret local avec les nouvelles valeurs
2. Chiffrez-le avec kubeseal :
   kubectl create secret generic temp-secret \
     --from-literal=KEY=VALUE \
     --dry-run=client -o yaml | \
   kubeseal -o yaml > sealed-secret.yaml

3. Mettez Ã  jour les valeurs encryptedData dans values.yaml
4. RedÃ©ployez avec ArgoCD ou Helm

Pour plus de dÃ©tails, consultez : homelab-cluster/docs/valhafin-sealed-secrets.md
{{- else }}

âš ï¸  Les Sealed Secrets sont dÃ©sactivÃ©s. Assurez-vous de gÃ©rer les secrets manuellement.
{{- end }}

ğŸ’¾ BASE DE DONNÃ‰ES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Se connecter Ã  PostgreSQL :
   kubectl exec -it -n {{ .Values.global.namespace }} {{ include "valhafin.fullname" . }}-database-0 -- \
     psql -U $(kubectl get secret -n {{ .Values.global.namespace }} {{ .Values.sealedSecrets.database.name }} -o jsonpath='{.data.POSTGRES_USER}' | base64 -d) \
          -d $(kubectl get secret -n {{ .Values.global.namespace }} {{ .Values.sealedSecrets.database.name }} -o jsonpath='{.data.POSTGRES_DB}' | base64 -d)

CrÃ©er un backup :
   kubectl exec -n {{ .Values.global.namespace }} {{ include "valhafin.fullname" . }}-database-0 -- \
     pg_dump -U $(kubectl get secret -n {{ .Values.global.namespace }} {{ .Values.sealedSecrets.database.name }} -o jsonpath='{.data.POSTGRES_USER}' | base64 -d) \
             $(kubectl get secret -n {{ .Values.global.namespace }} {{ .Values.sealedSecrets.database.name }} -o jsonpath='{.data.POSTGRES_DB}' | base64 -d) \
     > valhafin-backup-$(date +%Y%m%d-%H%M%S).sql

âš ï¸  IMPORTANT : PostgreSQL est configurÃ© avec un nodeSelector ({{ .Values.database.nodeSelector }}).
    Si ce node est indisponible, la base de donnÃ©es ne pourra pas dÃ©marrer.

ğŸ”§ DÃ‰PANNAGE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Si les pods ne dÃ©marrent pas :
   kubectl describe pod -n {{ .Values.global.namespace }} <POD_NAME>

Si les Secrets ne sont pas crÃ©Ã©s :
   - VÃ©rifiez que le Sealed Secrets Controller est installÃ© :
     kubectl get pods -n kube-system -l name=sealed-secrets-controller
   - VÃ©rifiez les logs du controller :
     kubectl logs -n kube-system -l name=sealed-secrets-controller

Si la base de donnÃ©es ne dÃ©marre pas :
   - VÃ©rifiez que le node {{ .Values.database.nodeSelector }} est disponible :
     kubectl get nodes
   - VÃ©rifiez que le PVC est bound :
     kubectl get pvc -n {{ .Values.global.namespace }}

Si l'Ingress ne fonctionne pas :
   - VÃ©rifiez que Traefik est installÃ© et fonctionne
   - VÃ©rifiez les logs de Traefik
   - VÃ©rifiez que le hostname est dans /etc/hosts ou rÃ©solu par DNS

ğŸ“š DOCUMENTATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Pour plus d'informations, consultez :
- README.md dans le chart Helm
- homelab-cluster/docs/valhafin-sealed-secrets.md pour la gestion des secrets
- Documentation ArgoCD pour l'intÃ©gration GitOps

ğŸ‰ Profitez de Valhafin !
